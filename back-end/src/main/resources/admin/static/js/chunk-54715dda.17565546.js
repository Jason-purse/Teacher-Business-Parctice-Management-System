(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-54715dda"],{"0cca":function(e,t,r){"use strict";var a=r("5530"),o=r("53ca"),n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"searchForm",r=this[t];"object"===Object(o["a"])(t)&&(r=t),null!=t&&r.startTimeAt&&r.endTimeAt&&(r.startTimeAt<r.endTimeAt||(this.$message.warning("结束时间必须大于开始时间 !!!"),r[e]=""))};t["a"]={methods:{validTimeRange:n,getSearchform:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.searchForm;return Object(a["a"])(Object(a["a"])({},r),{},{startTimeAt:null===(e=this.searchForm.startTimeAt)||void 0===e?void 0:e.getTime(),endTimeAt:null===(t=this.searchForm.endTimeAt)||void 0===t?void 0:t.getTime()})},onSubmit:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"searchForm",r=this[t];"object"===Object(o["a"])(t)&&(r=t),this.getDataFunc(this.getSearchform(r)).then((function(t){e.pager.page>1&&t&&t.totalPages&&t.totalPages<=1&&(e.pager.page=1,e.onSubmit()),e.pager.total=(null===t||void 0===t?void 0:t.totalElements)||0})).catch((function(t){e.$message.warning((null===t||void 0===t?void 0:t.message)||"系统错误 !!!`")}))},onReset:function(){this.$refs["searchForm"].resetFields(),console.log(this.$refs)},onCancel:function(e){var t;this[e].visible=!1,null===(t=this.$refs[e])||void 0===t||t.resetFields()},entryKeyDown:function(e){this.onSubmit()},datepickerInputFocus:function(e){console.log("失去焦点"),this.$refs[e].focus()}},data:function(){return{pager:{page:1,size:10,total:0}}}}},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},"4f87":function(e,t,r){},5:function(e,t){},"59d4":function(e,t,r){"use strict";r("4f87")},6:function(e,t){},"707c":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"search-line"},[r("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{inline:!0,model:e.searchForm},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.entryKeyDown(t)}}},[r("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[r("el-input",{ref:"input",attrs:{placeholder:"请输入项目名称",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),r("el-form-item",{attrs:{label:"发起人",prop:"username"}},[r("el-input",{attrs:{placeholder:"请输入发起人"},model:{value:e.searchForm.username,callback:function(t){e.$set(e.searchForm,"username",t)},expression:"searchForm.username"}})],1),r("el-form-item",{attrs:{label:"发起开始时间",prop:"startTimeAt"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},on:{change:function(t){return e.validTimeRange("startTimeAt")}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")&&e._k(t.keyCode,"a",void 0,t.key,void 0)?null:e.entryKeyDown(t)}},model:{value:e.searchForm.startTimeAt,callback:function(t){e.$set(e.searchForm,"startTimeAt",t)},expression:"searchForm.startTimeAt"}})],1),r("el-form-item",{attrs:{label:"发起结束时间",prop:"endTimeAt"}},[r("el-date-picker",{ref:"endTime",attrs:{type:"date",placeholder:"选择日期"},on:{change:function(t){return e.validTimeRange("endTimeAt")}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.entryKeyDown(t)}},model:{value:e.searchForm.endTimeAt,callback:function(t){e.$set(e.searchForm,"endTimeAt",t)},expression:"searchForm.endTimeAt"}})],1),r("el-form-item",[r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("查询")])],1),r("el-form-item",[r("el-button",{attrs:{type:"danger"},on:{click:e.onReset}},[e._v("重置")])],1)],1)],1)],1),r("el-divider",{staticClass:"margin-top-bottom-10"}),[r("div",{staticClass:"margin-top-bottom-10 margin-left-25"},[r("el-button",{attrs:{type:"success"},on:{click:function(t){return e.openProjectDrawer(!1)}}},[e._v("创建项目")])],1),r("el-table",{ref:"tableData",staticClass:"tableData",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"id"},on:{"row-click":e.expandRow,"expand-change":e.loadReportsTrigger}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("div",{style:{margin:"10px"}},[r("div",{staticClass:"margin-top-bottom-10 margin-left-25"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.openDialogCommitReport(a)}}},[e._v("提交报告")])],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.currentRow.loading,expression:"currentRow.loading"}],key:a.id,ref:"reportList",attrs:{"element-loading-spinner":"el-icon-loading",size:"small","row-key":"id",data:e.currentRow.reportList}},[r("el-table-column",{attrs:{label:"报告列表"}},[r("el-table-column",{attrs:{label:"名称",prop:"reportName",align:"center"}}),r("el-table-column",{attrs:{label:"描述",prop:"description",align:"center"}}),r("el-table-column",{attrs:{label:"发起人",prop:"submitUserName",align:"center"}}),r("el-table-column",{attrs:{label:"报告类型",prop:"reportType",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.reportType;return[e._v(" "+e._s(e.mapDictItemValue("reportTypes",r))+" ")]}}],null,!0)}),r("el-table-column",{attrs:{label:"报告格式",prop:"reportFormat",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.reportFormat;return[e._v(" "+e._s(e.mapDictItemValue("reportFormat",r))+" ")]}}],null,!0)}),r("el-table-column",{attrs:{label:"发起时间",prop:"createTimeStr",align:"center"}}),r("el-table-column",{attrs:{label:"审核人",prop:"auditUserName",align:"center"}}),r("el-table-column",{attrs:{label:"文件预览"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-link",{attrs:{size:"small"},on:{click:function(t){return e.pdfPreviewAction(a)}}},[e._v("点击预览")])]}}],null,!0)}),r("el-table-column",{attrs:{label:"审核阶段",prop:"auditPhase",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.auditPhase;return[e._v(" "+e._s(e.mapDictItemValue("auditPhase",r))+" ")]}}],null,!0)}),r("el-table-column",{attrs:{label:"审核状态",prop:"status",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.openDescriptionDialog(a)}}},[e._v(" "+e._s(e.mapDictItemValue("auditStatus",a.status))+" ")])]}}],null,!0)}),r("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[a.auditUserId?null!==a.failureFlag&&a.failureFlag&&a.submitUserId===e.currentUserInfo.id?[r("el-button",{attrs:{size:"small",type:"success"},on:{click:function(t){return e.restoreReportAction(a)}}},[e._v("重新申请")])]:e._e():[e.roleInfos.includes("admin")&&!a.assignFlag?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addAuditUser(a)}}},[e._v("指派审核 ")]):e._e()],r("el-button",{attrs:{disabled:a.finished,size:"small",type:"danger"},on:{click:function(t){return e.deleteReportDialogHandle(a)}}},[e._v("删除 ")])]}}],null,!0)})],1)],1)],1)]}}])}),r("el-table-column",{attrs:{type:"index",label:"序号"}}),r("el-table-column",{attrs:{label:"名称",prop:"name"}}),r("el-table-column",{attrs:{label:"描述",prop:"description"}}),r("el-table-column",{attrs:{label:"发起人",prop:"username"}}),r("el-table-column",{attrs:{label:"发起时间",prop:"createTimeStr"}}),r("el-table-column",{attrs:{label:"状态",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.status;return[e._v(" "+e._s(e.mapDictItemValue("projectStatus",r))+" ")]}}])}),r("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(r){return e.deleteDialogHandle(t)}}},[e._v("删除")]),r("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){return e.forceDeleteDialogHandle(t)}}},[e._v("强制删除")])]}}])})],1),r("div",{staticStyle:{"margin-top":"5px","text-align":"right"}},[r("el-pagination",{attrs:{small:"",background:"","current-page":e.pager.page,"page-size":e.pager.size,layout:"prev, pager, next",total:e.pager.total},on:{"update:currentPage":function(t){return e.$set(e.pager,"page",t)},"update:current-page":function(t){return e.$set(e.pager,"page",t)},"current-change":e.onSubmit}})],1)],r("el-drawer",{attrs:{title:e.drawerAction?"项目更新":"新建项目",visible:e.drawerFlag,size:"300px",direction:"rtl"},on:{"update:visible":function(t){e.drawerFlag=t}}},[r("el-form",{ref:"drawerRef",staticClass:"search-form",staticStyle:{padding:"5px"},attrs:{size:"small",model:e.drawerDialogData,rules:e.rules}},[r("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.drawerDialogData.name,callback:function(t){e.$set(e.drawerDialogData,"name",t)},expression:"drawerDialogData.name"}})],1),r("el-form-item",{attrs:{label:"项目描述",prop:"description"}},[r("el-input",{attrs:{placeholder:"请输入项目描述"},model:{value:e.drawerDialogData.description,callback:function(t){e.$set(e.drawerDialogData,"description",t)},expression:"drawerDialogData.description"}})],1),r("el-form-item",[r("el-form-item",{staticStyle:{"margin-top":"20px"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.saveProject()}}},[e._v("提交")])],1)],1)],1)],1),r("el-dialog",{attrs:{title:"提交报告",visible:e.reportForm.visible},on:{"update:visible":function(t){return e.$set(e.reportForm,"visible",t)}}},[r("el-form",{ref:"reportForm",attrs:{model:e.reportForm.data,rules:e.reportFormRule}},[r("el-form-item",{attrs:{label:"报告名称",prop:"reportName"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:e.reportForm.data.reportName,callback:function(t){e.$set(e.reportForm.data,"reportName",t)},expression:"reportForm.data.reportName"}})],1),r("el-form-item",{attrs:{label:"报告描述",prop:"description"}},[r("el-input",{attrs:{autocomplete:"off"},model:{value:e.reportForm.data.description,callback:function(t){e.$set(e.reportForm.data,"description",t)},expression:"reportForm.data.description"}})],1),r("el-form-item",{attrs:{label:"报告类型",prop:"reportType"}},[r("el-select",{attrs:{placeholder:"请选择报告类型"},model:{value:e.reportForm.data.reportType,callback:function(t){e.$set(e.reportForm.data,"reportType",t)},expression:"reportForm.data.reportType"}},e._l(e.reportTypes,(function(e){var t=e.itemType,a=e.itemValue,o=e.id;return r("el-option",{key:t,attrs:{label:a,value:o}})})),1)],1),r("el-form-item",{attrs:{label:"上传文件",prop:"fileList"}},[r("el-upload",{ref:"upload",attrs:{action:e.uploadActionUrl,accept:".pdf,.doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",limit:1,headers:{Authorization:e.getAccessToken()},"before-upload":e.validReportFormat,"on-success":e.uploadPostProcess,"on-exceed":e.maxFileLimitTop,"file-list":e.reportForm.data.fileList}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传文件")]),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能同时上传1个pdf/word文件，且不超过10M")])],1)],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){return e.onCancel("reportForm")}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.commitReport("save-report")}}},[e._v("确 定")])],1)],1),r("el-dialog",{attrs:{visible:e.visible,title:"选择指派审核人",width:"80%"},on:{"update:visible":function(t){e.visible=t},close:function(t){return e.auditDialogCancel()}}},[e.exists?[r("div",[r("el-steps",{attrs:{active:e.assignIndex,"align-center":!0}},e._l(e.auditPhase,(function(t,a){var o=t.id,n=t.itemValue;return r("el-step",{key:o,ref:"assignStep",refInFor:!0,attrs:{"finish-status":"success",simple:"",status:e.assignForm&&e.assignForm[a]?"success":"process",title:n,description:"请指派审核人"}})})),1)],1),r("div",[r("div",{staticClass:"search-line"},[r("el-form",{staticClass:"search-form",attrs:{inline:!0,model:e.userData.searchForm}},[r("el-form-item",{attrs:{label:"用户名称"}},[r("el-input",{attrs:{placeholder:"请输入用户名称"},model:{value:e.userData.searchForm.username,callback:function(t){e.$set(e.userData.searchForm,"username",t)},expression:"userData.searchForm.username"}})],1),r("el-form-item",{attrs:{label:"注册时间"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},on:{change:function(t){e.validTimeRange("startTimeAt"),e.userData.searchForm}},model:{value:e.userData.searchForm.startTimeAt,callback:function(t){e.$set(e.userData.searchForm,"startTimeAt",t)},expression:"userData.searchForm.startTimeAt"}})],1),r("el-form-item",{attrs:{label:"结束时间"}},[r("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},on:{change:function(t){return e.validTimeRange("endTimeAt",e.userData.searchForm)}},model:{value:e.userData.searchForm.endTimeAt,callback:function(t){e.$set(e.userData.searchForm,"endTimeAt",t)},expression:"userData.searchForm.endTimeAt"}})],1),r("el-form-item",[r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.getAllUserList}},[e._v("查询")])],1)],1)],1)],1),r("el-divider",{staticClass:"margin-top-bottom-10"}),[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userData.data}},[r("el-table-column",{attrs:{label:"昵称",prop:"nickname"}}),r("el-table-column",{attrs:{label:"姓名",prop:"username"}}),r("el-table-column",{attrs:{label:"角色",prop:"roles"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row.roles;return[e._v(" "+e._s(r.map((function(e){return e.itemValue})))+" ")]}}],null,!1,1563746375)}),r("el-table-column",{attrs:{label:"操作",width:"250px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.createAuditAction(a)}}},[e._v("指派")])]}}],null,!1,3124715724)})],1),r("div",{staticStyle:{"margin-top":"5px","text-align":"right"}},[r("el-pagination",{attrs:{small:"",background:"","current-page":e.userData.pager.page,"page-size":e.userData.pager.size,layout:"prev, pager, next",total:e.userData.pager.total},on:{"update:currentPage":function(t){return e.$set(e.userData.pager,"page",t)},"update:current-page":function(t){return e.$set(e.userData.pager,"page",t)}}})],1)]],2)]:e._e()],2),r("el-dialog",{attrs:{title:"审核结果-历史记录",visible:e.auditResult.visible,width:"60%"},on:{"update:visible":function(t){return e.$set(e.auditResult,"visible",t)},close:function(t){e.auditResult.visible=!1,e.auditResult.description=""}}},[r("span",[e._v(e._s(e.auditResult.description))]),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.auditResult.visible=!1,e.auditResult.description=""}}},[e._v("关闭")])],1)]),r("el-dialog",{staticClass:"preview-dialog",attrs:{title:"文件浏览",width:"fit-content",visible:e.pdfPreview.visible},on:{"update:visible":function(t){return e.$set(e.pdfPreview,"visible",t)},close:e.closePdfPreview}},[e.pdfPreview.fileType.includes("pdf")?r("pdf",{key:e.pdfPreview.url,attrs:{page:e.pdfPreview.pageNum,src:e.pdfPreview.url},on:{"num-pages":function(t){e.pdfPreview.totalPages=t},error:e.previewError}}):[r("vue-office-docx",{key:e.pdfPreview.url,attrs:{src:e.pdfPreview.url}})]],2)],2)},o=[],n=r("5530"),i=(r("a4d3"),r("e01a"),r("d81d"),r("ac1f"),r("5319"),r("c740"),r("d3b7"),r("b0c0"),r("0cca")),s=(r("99af"),r("b775")),l="/api/admin/project/v1",c={getAllProjectsByPageUrl:"".concat(l,"/list"),createProjectUrl:"".concat(l),updateProjectUrl:"".concat(l),deleteProjectByIdUrl:"".concat(l,"/"),getProjectByIdUrl:"".concat(l)},u={getAllProjectsByPage:function(e,t){return s["a"].get(c.getAllProjectsByPageUrl,{params:Object(n["a"])(Object(n["a"])({},e),{},{page:t.page-1,size:t.size})})},createProject:function(e){return s["a"].post(c.createProjectUrl,e)},updateProject:function(e){return s["a"].put(c.updateProjectUrl,e)},deleteProjectById:function(e,t){return s["a"].delete(c.deleteProjectByIdUrl.concat(e),{params:t})},getProjectById:function(e){return s["a"].get(c.getProjectByIdUrl.concat("/".concat(e)))}},d="/api/admin/report/v1",p={getAllReportsUrl:"".concat(d,"/list/"),createReportUrl:"".concat(d),updateReportUrl:"".concat(d),deleteReportUrl:"".concat(d)},m={methods:{loadReports:function(e){return s["a"].get(p.getAllReportsUrl.concat(e))},createReport:function(e){return s["a"].post(p.createReportUrl,e)},updateReport:function(e){return s["a"].put(p.updateReportUrl,e)},deleteReport:function(e){return s["a"].delete(p.deleteReportUrl.concat("/".concat(e)))}}},f=r("b705"),g=r("c24f"),h=r("a796"),v=r("5f87"),b=r("77c4"),w=r("2f62"),y=r("858e"),F=r("2d46"),R=r.n(F),D={name:"Index",components:{pdf:y["a"],VueOfficeDocx:R.a},data:function(){return Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({roleInfos:Object(v["c"])(),currentUserInfo:null,assignForm:[],assignIndex:1,exists:!1,visible:!1,pdfPreview:{url:"",pageNum:1,totalPages:1,pageRotate:"",fileType:"",visible:!1},rules:{name:[{required:!0,trigger:["blur","change"],message:"请输入项目名称"}],description:[{required:!0,trigger:["blur","change"],message:"请输入项目描述"}]},audit:{data:{},auditPhases:[]},auditResult:{description:"",visible:!1},userData:{searchForm:{username:"",startTimeAt:"",endTimeAt:""},data:[],pager:{page:0,size:10}},searchForm:{name:"",status:"",username:"",startTimeAt:null,endTimeAt:null,creatTimeAt:null},tableData:[]},i["a"].data()),h["a"].data()),f["a"].data()),{},{drawerFlag:!1,drawerAction:!1,drawerDialogData:{name:"",description:""},fileFormats:["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword"],currentRow:{row:null,reportList:[],index:-1,loading:!1},reportForm:{data:{reportName:"",description:"",reportType:"",reportFormat:"",reportUrlId:"",fileList:[]},currentRow:null,visible:!1},reportFormRule:{reportName:[{required:!0,trigger:["blur","change"],message:"请输入报告名称"}],description:[{required:!0,trigger:["blur","change"],message:"请输入报告描述"}],reportType:[{required:!0,trigger:["blur","change"],message:"请选择报告类型"}],reportFormat:[{required:!0,trigger:["blur","change"],message:"请选择报告格式"}]}})},created:function(){var e=this;console.log("uses"),this.onSubmit(),this.getReportTypes(),this.getReportFormat(),this.getAuditPhase(),this.getAuditStatus(),this.getProjectStatus(),this.getMediaTypes(),this.getCurrentUserInfo().then((function(t){var r=t.result;e.currentUserInfo=r}))},mounted:function(){},methods:Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(w["d"])("user",["userInfo"])),{},{getAccessToken:v["a"]},i["a"].methods),u),m.methods),f["a"].methods),b["a"].methods),h["a"].methods),g["a"].methods),{},{getAllUserList:function(){var e=this;g["a"].methods.getAllUsersByPage(this.userData.searchForm,this.userData.pager).then((function(t){var r=t.result.content;e.userData.data=r||[]}))},previewError:function(){this.$message.error("预览文件失败,无法加载此文件 !!!"),this.pdfPreview={visible:!1,pageNum:1,url:"",totalPages:1,fileType:""}},expandRow:function(e){this.currentRow.row!==e&&this.$refs.tableData.toggleRowExpansion(e,[e])},closePdfPreview:function(){this.pdfPreview.visible=!1},openDescriptionDialog:function(e){var t=e.failureReason,r=e.successDescription,a=e.failureFlag;this.auditResult.visible=!0,this.auditResult.description=(a?t:r)||"没有任何说明 !!"},getDataFunc:function(){var e=this;return this.getAllProjectsByPage(this.getSearchform(),this.pager).then((function(t){var r=t.result;return e.tableData=r.content.map((function(e,t){return e.index=t,e})),r}))},openProjectDrawer:function(e){e&&(this.drawerAction=!0),this.drawerFlag=!0,this.currentRow&&this.$refs.tableData.toggleRowExpansion(this.currentRow.row,!1)},auditDialogCancel:function(){this.userData.searchForm={},this.audit={},this.assignForm=[],this.assignIndex=1,this.exists=!1,this.visible=!1},uploadPostProcess:function(e){var t=this,r=e.code,a=e.result;200!==r?(this.$message.error("上传失败!!!"),setTimeout((function(){var e;null===(e=t.$refs.upload)||void 0===e||e.clearFiles()}),500)):(this.reportForm.data.reportUrlId=a.id,this.$message.success("上传成功 !!!"))},createAuditAction:function(e){var t=this;this.$nextTick((function(){if(t.assignForm[t.assignIndex-1]={reportId:t.audit.data.id,userId:e.id,username:e.username,auditPhaseId:t.auditPhase[t.assignIndex-1].id},t.auditPhase.length===t.assignIndex)return t.createAudit({reportId:t.audit.data.id,auditHandlers:t.assignForm}).then((function(){t.$message.success("指派成功 !!!"),t.auditDialogCancel(),t.updateReportList()})).catch((function(){t.$message.error("指派失败 !!!")})),t.auditDialogCancel(),void console.log("清理",t.audit.visible);t.assignIndex+=1}))},pdfPreviewAction:function(e){var t=e.reportUrlStr,r=e.mediaType;this.pdfPreview.url=t.replace(/\\/g,"/"),this.pdfPreview.visible=!0,this.pdfPreview.fileType=this.mapDictItemType("mediaType",r)},validReportFormat:function(e){var t=e.type,r=this.reportFormat.findIndex((function(e){return e.itemType===t}));return r?(this.reportForm.data.reportFormat=r.id,!0):(this.$message.warning("当前上传类型和选择类型不符合,请检查 !!"),!1)},closeDrawer:function(){this.drawerFlag=!1,this.drawerDialogData={}},saveProject:function(){var e=this;this.$refs.drawerRef.validate((function(t){t?(e.drawerAction?e.updateProject(e.drawerDialogData).then((function(){e.$message.success("更新项目成功 !!!"),e.onSubmit(),e.closeDrawer()})):e.createProject(e.drawerDialogData).then((function(){e.$message.success("新建项目成功 !!!"),e.onSubmit(),e.closeDrawer()})),e.currentRow={row:null,index:-1,reportList:[]}):e.$message.warning("请输入")}))},openDialogCommitReport:function(e){var t;this.reportForm.visible=!0,null===(t=this.$refs.reportForm)||void 0===t||t.resetFields(),this.reportForm.currentRow=e},loadReportsTrigger:function(e,t){var r=this;console.log(this.currentRow),-1!==t.indexOf(e)?(this.currentRow.loading=!1,this.currentRow.row&&this.currentRow.row!==e?(this.$refs.tableData.toggleRowExpansion(this.currentRow.row,!1),this.currentRow.reportList=[],this.currentRow.row=e,this.currentRow.index=e.index):this.currentRow.row||(this.currentRow.reportList=[],this.currentRow.row=e,this.currentRow.index=e.index),this.loadReports(e.id).then((function(e){var t=e.result;r.currentRow.reportList=t})).catch((function(){r.currentRow.reportList=[]})).finally((function(){r.currentRow.loading=!1}))):this.currentRow.loading=!1},deleteDialogHandle:function(e){var t=this,r=e.row,a=r.id,o=r.name;this.$confirm("确定删除项目".concat(o,"?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteProjectById(a).then((function(){t.$message({type:"success",message:"删除成功!"}),t.onSubmit()}))})).catch((function(){}))},forceDeleteDialogHandle:function(e){var t=this,r=e.row,a=r.id,o=r.name;this.$confirm("确定强制删除项目".concat(o,"? 这会删除项目有关的所有东西，包括提交的报告。"),"强制删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteProjectById(a,{force:!0}).then((function(){t.$message({type:"success",message:"删除成功!"}),t.onSubmit()}))})).catch((function(){}))},updateReportList:function(){var e=this;this.getProjectById(this.currentRow.row.id).then((function(t){var r=t.result;e.$set(e.tableData,e.currentRow.row.index,r)})),this.loadReports(this.currentRow.row.id).then((function(t){var r=t.result;e.currentRow.reportList=r}))},addAuditUser:function(e){this.exists=!0,this.visible=!0,this.getAllUserList(),console.log(e),this.audit.data=e},restoreReportAction:function(e){var t=this,r=Object(n["a"])(Object(n["a"])({},e),{},{restore:!0});this.updateReport(r).then((function(){t.updateReportList()}))},deleteReportDialogHandle:function(e){var t=this,r=e.reportName,a=e.id;this.$confirm("确定删除报告".concat(r,"?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteReport(a).then((function(){t.$message({type:"success",message:"删除成功!"}),t.updateReportList()}))})).catch((function(){}))},commitReport:function(e){var t=this;this.$refs.reportForm.validate((function(r){if(r){var a;if("save-report"===e)t.createReport(Object(n["a"])(Object(n["a"])({},t.reportForm.data),{},{projectId:null===(a=t.reportForm.currentRow)||void 0===a?void 0:a.id})).then((function(){t.$message.success("新增报告成功!!!"),t.updateReportList()}));else"update-report"===e&&t.updateReport(t.reportForm.data).then((function(){t.$message.success("更新报告成功 !!!"),t.updateReportList()}));t.onCancel("reportForm")}else t.$message.warning("请输入")}))},maxFileLimitTop:function(){this.$message.warning("只能上传一个文件!!!")}})},A=D,k=(r("59d4"),r("2877")),x=Object(k["a"])(A,a,o,!1,null,"0553623c",null);t["default"]=x.exports},"77c4":function(e,t,r){"use strict";var a=r("5530"),o=r("b775"),n="/api/admin/audit/v1",i={createAuditUrl:"".concat(n),allReportsForAuditUrl:"".concat(n),updateAuditUrl:"".concat(n)};t["a"]={methods:{createAudit:function(e){return o["a"].post(i.createAuditUrl,e)},getAllReportsForAudit:function(e,t){return o["a"].get(i.allReportsForAuditUrl,{params:Object(a["a"])(Object(a["a"])({},e),{},{page:t.page-1,size:t.size})})},auditUpdate:function(e){return o["a"].put(i.updateAuditUrl,e)}}}},a796:function(e,t,r){"use strict";var a=r("5530"),o=(r("99af"),r("b775")),n="/api/admin/attachment/v1",i={uploadUrl:"".concat(n,"/upload"),getAllAttendanceByPageUrl:"".concat(n,"/list"),deleteAttachmentById:"".concat(n)};t["a"]={data:function(){return{uploadActionUrl:i.uploadUrl}},methods:{getAllAttachmentByPage:function(e,t){return o["a"].get(i.getAllAttendanceByPageUrl,{params:Object(a["a"])(Object(a["a"])({},e),{},{page:t.page-1,size:t.size})})},deleteAttachmentById:function(e){return o["a"].delete(i.deleteAttachmentById.concat("/".concat(e)))},getAttachmentStaticResource:function(e){return o["a"].get(e)}}}},c740:function(e,t,r){"use strict";var a=r("23e7"),o=r("b727").findIndex,n=r("44d2"),i=r("ae40"),s="findIndex",l=!0,c=i(s);s in[]&&Array(1)[s]((function(){l=!1})),a({target:"Array",proto:!0,forced:l||!c},{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),n(s)}}]);